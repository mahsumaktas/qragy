<!doctype html>
<html lang="tr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover" />
    <title>Qragy Admin</title>
    <link rel="icon" type="image/jpeg" href="qragy_logo.jpg" />
    <link rel="stylesheet" href="admin.css?v=20260222b" />
  </head>
  <body>
    <main class="admin-shell">

      <!-- Header -->
      <header class="admin-header">
        <div style="display:flex;align-items:center;gap:12px">
          <img src="qragy_logo.jpg" alt="Qragy" style="width:36px;height:36px;object-fit:contain;border-radius:8px" />
          <h1>Qragy Admin</h1>
        </div>
      </header>

      <!-- Sidebar + Content Layout -->
      <div class="admin-layout">

        <!-- Sidebar -->
        <aside class="admin-sidebar">

          <!-- Admin Token (moved into sidebar) -->
          <div class="sidebar-token">
            <label>
              <span>Admin Token</span>
              <input id="adminToken" type="password" placeholder="x-admin-token" />
            </label>
          </div>

          <nav class="sidebar-nav">
            <!-- TALEPLER group -->
            <div class="nav-group">
              <div class="nav-group-label">TALEPLER</div>
              <a class="nav-item active" data-panel="panelSummary">Ozet</a>
              <a class="nav-item" data-panel="panelLiveChats">Canli Sohbetler <span id="convCount" class="nav-badge">0</span></a>
              <a class="nav-item" data-panel="panelClosedChats">Kapali Sohbetler</a>
              <a class="nav-item" data-panel="panelSearch">Arama</a>
              <a class="nav-item" data-panel="panelInbox">Agent Inbox <span id="inboxCount" class="nav-badge">0</span></a>
            </div>

            <!-- DUZENLEMELER group -->
            <div class="nav-group">
              <div class="nav-group-label">DUZENLEMELER</div>
              <a class="nav-item" data-panel="panelBotSetup">Bot Ayarlari</a>
              <a class="nav-item" data-panel="panelBotTest">Bot Test</a>
              <a class="nav-item" data-panel="panelKB">Bilgi Tabani</a>
              <a class="nav-item" data-panel="panelTopics">Konular</a>
              <a class="nav-item" data-panel="panelChatFlow">Sohbet Akisi</a>
              <a class="nav-item" data-panel="panelSiteConfig">Site Ayarlari</a>
            </div>

            <!-- ENTEGRASYONLAR group -->
            <div class="nav-group">
              <div class="nav-group-label">ENTEGRASYONLAR</div>
              <a class="nav-item" data-panel="panelSunshine">CRM Entegrasyonu</a>
              <a class="nav-item" data-panel="panelWhatsApp">WhatsApp</a>
            </div>

            <!-- SISTEM group (toggle ile gizlenebilir) -->
            <div class="nav-group">
              <div id="advancedToggle" class="nav-advanced-toggle">Sistem &#9662;</div>
              <a class="nav-item advanced" data-panel="panelAnalytics">Dashboard</a>
              <a class="nav-item advanced" data-panel="panelEnv">Ortam Degiskenleri</a>
              <a class="nav-item advanced" data-panel="panelWebhooks">Webhooks</a>
              <a class="nav-item advanced" data-panel="panelAutoFAQ">FAQ Onerileri</a>
              <a class="nav-item advanced" data-panel="panelPromptVersions">Prompt Gecmisi</a>
              <a class="nav-item advanced" data-panel="panelFeedbackReport">Feedback Raporu</a>
              <a class="nav-item advanced" data-panel="panelContentGaps">Content Gaps</a>
              <a class="nav-item advanced" data-panel="panelSystem">Sistem Durumu</a>
              <a class="nav-item advanced" data-panel="panelAgentFiles">Agent Dosyalari</a>
              <a class="nav-item advanced" data-panel="panelMemory">Bellek Sablonlari</a>
            </div>
          </nav>
        </aside>

        <!-- Main Content -->
        <div class="admin-main">

          <!-- PANEL: Ozet -->
          <div id="panelSummary" class="panel active">
            <!-- Onboarding Checklist -->
            <div id="onboardingChecklist" class="onboarding-checklist" style="display:none;">
              <div class="checklist-header">
                <h3>Baslangic Rehberi</h3>
                <button id="onboardingDismiss" class="btn btn-sm" title="Kapat">&times;</button>
              </div>
              <ul id="onboardingItems"></ul>
              <div id="onboardingComplete" style="display:none;" class="checklist-complete">
                Tebrikler! Tum adimlari tamamladiniz.
              </div>
            </div>
            <section class="summary-grid" id="summaryGrid"></section>

            <div class="panel-split">
              <div class="panel-split-left">
                <section class="table-section">
                  <table>
                    <thead>
                      <tr>
                        <th>Ticket</th>
                        <th>Durum</th>
                        <th>Öncelik</th>
                        <th>Şube</th>
                        <th>Sorun</th>
                        <th>Atanan</th>
                        <th>Kaynak</th>
                        <th>Oluşturma</th>
                        <th>Detay</th>
                      </tr>
                    </thead>
                    <tbody id="ticketsTableBody">
                      <tr>
                        <td colspan="9" class="empty">Yükleniyor...</td>
                      </tr>
                    </tbody>
                  </table>
                </section>
              </div>

              <div class="panel-split-right">
                <section class="detail-section">
                  <h2>Ticket Detayı</h2>
                  <div id="ticketDetail" class="detail-box">Bir ticket seçiniz.</div>

                  <!-- Team features: assign, priority, notes -->
                  <div id="ticketActions" class="ticket-actions" style="display:none">
                    <div class="action-row">
                      <label>Atama: <input id="ticketAssignInput" type="text" placeholder="Kullanıcı adı" /></label>
                      <button id="ticketAssignBtn" class="btn btn-sm btn-primary">Ata</button>
                      <label>Öncelik:
                        <select id="ticketPrioritySelect">
                          <option value="low">Düşük</option>
                          <option value="normal" selected>Normal</option>
                          <option value="high">Yüksek</option>
                        </select>
                      </label>
                      <button id="ticketPriorityBtn" class="btn btn-sm btn-primary">Değiştir</button>
                    </div>
                    <div class="action-row">
                      <textarea id="ticketNoteInput" rows="2" placeholder="Dahili not ekle..."></textarea>
                      <button id="ticketNoteBtn" class="btn btn-sm btn-primary">Not Ekle</button>
                    </div>
                    <div id="ticketNotesList" class="notes-list"></div>
                  </div>

                  <h3 style="margin-top:14px">Sohbet Geçmişi</h3>
                  <div id="chatHistory" class="chat-history-container">Ticket seçiniz.</div>
                </section>
              </div>
            </div>
          </div>

          <!-- PANEL: Canli Sohbetler -->
          <div id="panelLiveChats" class="panel">
            <div class="section-header" style="margin-bottom:8px;display:flex;align-items:center;gap:12px">
              <h3>Canlı Sohbetler <span class="badge">0</span></h3>
              <button type="button" id="closeAllConvsBtn" class="open-button" style="font-size:12px;padding:4px 10px">Tümünü Kapat</button>
            </div>
            <div class="table-section">
              <table>
                <thead>
                  <tr>
                    <th>Oturum</th>
                    <th>Durum</th>
                    <th>Mesaj</th>
                    <th>Son Mesaj</th>
                    <th>Şube</th>
                    <th>Kaynak</th>
                    <th>Başlangıç</th>
                    <th>Güncelleme</th>
                    <th>Detay</th>
                  </tr>
                </thead>
                <tbody id="liveConvsTableBody">
                  <tr><td colspan="9" class="empty">Yükleniyor...</td></tr>
                </tbody>
              </table>
            </div>
            <div id="liveChatDetail" class="chat-detail-inline"></div>
          </div>

          <!-- PANEL: Kapali Sohbetler -->
          <div id="panelClosedChats" class="panel">
            <div class="section-header" style="margin-bottom:8px;display:flex;align-items:center;gap:12px">
              <h3>Kapalı Sohbetler <span id="closedConvCount" class="badge">0</span></h3>
            </div>
            <div class="table-section">
              <table>
                <thead>
                  <tr>
                    <th>Oturum</th>
                    <th>Durum</th>
                    <th>Mesaj</th>
                    <th>Son Mesaj</th>
                    <th>Şube</th>
                    <th>Kaynak</th>
                    <th>Başlangıç</th>
                    <th>Güncelleme</th>
                    <th>Detay</th>
                  </tr>
                </thead>
                <tbody id="closedConvsTableBody">
                  <tr><td colspan="9" class="empty">Yükleniyor...</td></tr>
                </tbody>
              </table>
            </div>
            <div id="closedChatDetail" class="chat-detail-inline"></div>
          </div>

          <!-- PANEL: Arama -->
          <div id="panelSearch" class="panel">
            <section class="admin-controls">
              <label class="control">
                <span>Arama</span>
                <input id="searchFilter" type="text" placeholder="Ticket, şube, sorun ara..." />
              </label>

              <label class="control">
                <span>Durum</span>
                <select id="statusFilter">
                  <option value="">Tüm durumlar</option>
                  <option value="handoff_pending">handoff_pending</option>
                  <option value="queued_after_hours">queued_after_hours</option>
                  <option value="handoff_success">handoff_success</option>
                  <option value="handoff_failed">handoff_failed</option>
                  <option value="handoff_parent_posted">handoff_parent_posted</option>
                  <option value="handoff_opened_no_summary">handoff_opened_no_summary</option>
                </select>
              </label>

              <label class="control">
                <span>Kaynak</span>
                <select id="sourceFilter">
                  <option value="">Tümü</option>
                  <option value="web">Web</option>
                  <option value="telegram">Telegram</option>
                  <option value="sunshine">Sunshine</option>
                  <option value="whatsapp">WhatsApp</option>
                </select>
              </label>

              <label class="control">
                <span>Kayıt limiti</span>
                <select id="limitFilter">
                  <option value="50">50</option>
                  <option value="100" selected>100</option>
                  <option value="250">250</option>
                </select>
              </label>

              <div class="control-buttons">
                <button id="refreshButton" type="button">Yenile</button>
                <button id="autoButton" type="button" data-active="1">Oto Yenile: Açık</button>
                <button id="exportTicketsBtn" type="button">Dışarı Aktar (CSV)</button>
              </div>
            </section>

            <!-- Bulk Actions Toolbar -->
            <section id="bulkToolbar" class="bulk-toolbar" hidden>
              <span id="bulkSelectedCount">0 seçili</span>
              <button id="bulkCloseBtn" type="button" class="btn btn-secondary">Kapat</button>
              <select id="bulkPrioritySelect"><option value="">Öncelik Seç</option><option value="low">Düşük</option><option value="normal">Normal</option><option value="high">Yüksek</option></select>
              <button id="bulkPriorityBtn" type="button" class="btn btn-secondary">Öncelik Değiştir</button>
              <input id="bulkAssignInput" type="text" placeholder="Atama..." style="width:120px" />
              <button id="bulkAssignBtn" type="button" class="btn btn-secondary">Ata</button>
            </section>

            <section class="table-section">
              <table>
                <thead>
                  <tr>
                    <th>Ticket</th>
                    <th>Durum</th>
                    <th>Öncelik</th>
                    <th>Şube</th>
                    <th>Sorun</th>
                    <th>Atanan</th>
                    <th>Kaynak</th>
                    <th>Oluşturma</th>
                    <th>Detay</th>
                  </tr>
                </thead>
                <tbody id="searchTicketsTableBody">
                  <tr>
                    <td colspan="9" class="empty">Yükleniyor...</td>
                  </tr>
                </tbody>
              </table>
            </section>

            <div id="searchTicketDetail" class="chat-detail-inline"></div>
          </div>

          <!-- PANEL: Agent Inbox -->
          <div id="panelInbox" class="panel">
            <div class="section-header" style="margin-bottom:12px;display:flex;align-items:center;gap:12px">
              <h3>Agent Inbox</h3>
              <button type="button" id="inboxRefreshBtn" class="btn btn-secondary" style="font-size:12px;padding:4px 10px">Yenile</button>
            </div>
            <div class="inbox-layout">
              <!-- Left: Queue list -->
              <div class="inbox-queue-panel">
                <h4 style="margin:0 0 8px">Bekleyenler <span id="inboxPendingCount" class="badge">0</span></h4>
                <div id="inboxPendingList" class="inbox-list">
                  <p class="empty">Kuyrukta kimse yok.</p>
                </div>
                <h4 style="margin:16px 0 8px">Aktif Gorusmeler <span id="inboxActiveCount" class="badge">0</span></h4>
                <div id="inboxActiveList" class="inbox-list">
                  <p class="empty">Aktif gorusme yok.</p>
                </div>
              </div>
              <!-- Right: Chat view -->
              <div class="inbox-chat-panel">
                <div id="inboxChatHeader" class="inbox-chat-header">
                  <span>Bir gorusme secin</span>
                </div>
                <div id="inboxChatMessages" class="inbox-chat-messages">
                  <p class="empty">Gorusme secilmedi.</p>
                </div>
                <div id="inboxChatActions" class="inbox-chat-actions" style="display:none">
                  <input id="inboxMessageInput" type="text" placeholder="Mesaj yazin..." class="inbox-message-input" />
                  <button id="inboxSendBtn" class="btn btn-primary">Gonder</button>
                  <button id="inboxReleaseBtn" class="btn btn-secondary">Birak</button>
                </div>
              </div>
            </div>
          </div>

          <!-- PANEL: Bilgi Tabani Kayitlar -->
          <div id="panelKB" class="panel">
            <div class="section-header">
              <h2>Bilgi Tabani <span id="kbRecordCount" class="badge">0</span></h2>
              <div class="section-actions">
                <button id="kbAddBtn" class="btn btn-primary">+ Yeni Kayıt</button>
                <label class="btn btn-secondary file-upload-label">
                  Dosya Yükle
                  <input id="kbFileUpload" type="file" accept=".pdf,.docx,.txt,.xlsx,.xls" multiple style="display:none" />
                </label>
                <button id="kbUrlImportBtn" class="btn btn-secondary">URL Aktar</button>
                <button id="kbReingestBtn" class="btn btn-secondary">Yeniden Yükle</button>
                <span id="kbReingestStatus" class="status-text"></span>
                <span id="kbUploadStatus" class="status-text"></span>
              </div>
            </div>
            <div class="table-section">
              <table>
                <thead>
                  <tr>
                    <th>#</th>
                    <th>Soru</th>
                    <th>Cevap</th>
                    <th>İşlemler</th>
                  </tr>
                </thead>
                <tbody id="kbTableBody">
                  <tr>
                    <td colspan="4" class="empty">Yükleniyor...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- PANEL: FAQ Onerileri -->
          <div id="panelAutoFAQ" class="panel">
            <div class="section-header">
              <h3>Önerilen FAQ'lar (Otomatik)</h3>
              <button id="autoFaqGenerateBtn" class="btn btn-secondary">FAQ Oluştur</button>
            </div>
            <div id="autoFaqSection" class="table-section">
              <p class="empty">Henüz öneri yok.</p>
            </div>
          </div>

          <!-- PANEL: Agent Dosyalari -->
          <div id="panelAgentFiles" class="panel">
            <div style="padding:8px 12px;margin-bottom:12px;background:rgba(12,93,102,0.06);border:1px solid rgba(12,93,102,0.15);border-radius:6px;font-size:0.82rem;color:var(--primary)">
              Bu dosyalar <a href="#" onclick="switchPanel('panelBotSetup');return false" style="font-weight:600;color:var(--primary)">Duzenlemeler &gt; Bot Ayarlari</a> bolumunden form olarak da duzenlenebilir.
            </div>
            <div class="agent-tabs">
              <button class="agent-tab active" data-agent-tab="editor">Dosyalar</button>
              <button class="agent-tab" data-agent-tab="easyEdit">Kolay Duzenle</button>
            </div>

            <!-- Tab: File Editor -->
            <div id="agentTabEditor" class="agent-tab-content">
              <div class="editor-layout">
                <div class="file-list-panel">
                  <h3>Dosyalar</h3>
                  <ul id="agentFileList"></ul>
                </div>
                <div class="editor-panel">
                  <div class="editor-header">
                    <span id="agentEditorFilename" class="editor-filename">Dosya seciniz</span>
                    <div class="editor-actions">
                      <button id="agentEditorRevertBtn" class="btn btn-secondary" disabled>Geri Al</button>
                      <button id="agentEditorSaveBtn" class="btn btn-primary" disabled>Kaydet</button>
                    </div>
                  </div>
                  <textarea id="agentEditorTextarea" class="code-editor" placeholder="Dosya seciniz..." disabled></textarea>
                </div>
              </div>
            </div>

            <!-- Tab: Easy Persona Editor -->
            <div id="agentTabEasyEdit" class="agent-tab-content" style="display:none">
              <div class="easy-persona-form">
                <h3>Bot Kisiligini Ozellestiriniz</h3>
                <p class="field-hint" style="margin-bottom:16px">Asagidaki formu doldurarak bot kisiligini hizlica ayarlayin. Kaydet'e bastiginizda persona.md otomatik olusturulur.</p>
                <div class="form-grid">
                  <label>Bot Adi<input id="easyPersonaName" type="text" placeholder="Ornek: Asistan" /></label>
                  <label>Konusma Tonu
                    <select id="easyPersonaTone">
                      <option value="profesyonel">Profesyonel</option>
                      <option value="samimi">Samimi</option>
                      <option value="resmi">Resmi</option>
                    </select>
                  </label>
                </div>
                <label>Selamlama Ornegi<input id="easyPersonaGreeting" type="text" placeholder="Ornek: Merhaba! Size nasil yardimci olabilirim?" /></label>
                <label>Kisa Tanitim<textarea id="easyPersonaDescription" rows="4" placeholder="Ornek: Ben XYZ firmasinin musteri destek asistaniyim. Urunler, siparisler ve teknik konularda yardimci olabilirim."></textarea></label>
                <button id="easyPersonaSaveBtn" class="btn btn-primary" style="margin-top:12px">Kaydet</button>
              </div>
            </div>
          </div>

          <!-- PANEL: Bot Ayarlari (Duzenlemeler) -->
          <div id="panelBotSetup" class="panel">
            <div class="bot-setup-layout">
              <div class="bot-setup-nav">
                <a class="bot-setup-nav-item active" data-setup-tab="company"><span class="status-dot inactive"></span>Firma Bilgileri</a>
                <a class="bot-setup-nav-item" data-setup-tab="persona"><span class="status-dot inactive"></span>Bot Kisiligi</a>
                <a class="bot-setup-nav-item" data-setup-tab="skills"><span class="status-dot inactive"></span>Yetenekler</a>
                <a class="bot-setup-nav-item" data-setup-tab="bans"><span class="status-dot inactive"></span>Yasaklar</a>
                <a class="bot-setup-nav-item" data-setup-tab="escalation"><span class="status-dot inactive"></span>Eskalasyon Kurallari</a>
                <a class="bot-setup-nav-item" data-setup-tab="chatflow"><span class="status-dot inactive"></span>Sohbet Akisi</a>
                <a class="bot-setup-nav-item" data-setup-tab="appearance"><span class="status-dot inactive"></span>Gorunum</a>
                <a class="bot-setup-nav-item" data-setup-tab="ticket"><span class="status-dot inactive"></span>Talep Bilgileri</a>
              </div>
              <div class="bot-setup-content">
                <!-- Tab: Firma Bilgileri -->
                <div id="botSetupTab-company" class="bot-setup-tab active">
                  <div class="bot-setup-form">
                    <h3>Firma Bilgileri</h3>
                    <p class="section-desc">Botun kullanacagi temel firma ve platform bilgilerini tanitin.</p>

                    <label for="bsCompanyName">Firma Adi</label>
                    <span class="field-hint">Botun kullanacagi firma adi</span>
                    <input id="bsCompanyName" type="text" placeholder="Ornek: ABC Teknoloji" />

                    <label for="bsSector">Sektor</label>
                    <span class="field-hint">Sektorunuz</span>
                    <select id="bsSector">
                      <option value="teknik-destek">Teknik Destek</option>
                      <option value="e-ticaret">E-Ticaret</option>
                      <option value="restoran">Restoran / Yemek</option>
                      <option value="saglik">Saglik</option>
                      <option value="egitim">Egitim</option>
                      <option value="diger">Diger</option>
                    </select>

                    <label for="bsMission">Misyon</label>
                    <span class="field-hint">Botun temel gorevi. Ornek: Kullanicinin sorununu mumkunse kendi basina cozmek</span>
                    <textarea id="bsMission" rows="2" placeholder="Botun temel gorevi nedir?"></textarea>

                    <label for="bsValues">Degerler</label>
                    <span class="field-hint">Virgul ile. Ornek: Cozum odaklilik, dogruluk, sabir</span>
                    <input id="bsValues" type="text" placeholder="Cozum odaklilik, dogruluk, sabir" />

                    <label for="bsPlatformDesc">Platform Aciklamasi</label>
                    <span class="field-hint">Firmaniz ne yapar? Bot bu bilgiyi kullanir</span>
                    <textarea id="bsPlatformDesc" rows="4" placeholder="Ornek: ABC Platform, B2B SaaS operasyon yonetim sistemidir."></textarea>

                    <label for="bsProducts">Urunler / Hizmetler</label>
                    <span class="field-hint">Sundugunuz urunler veya hizmetler</span>
                    <textarea id="bsProducts" rows="3" placeholder="Her satira bir urun/hizmet yazin"></textarea>

                    <label>Ozel Terimler</label>
                    <span class="field-hint">Sektore ozel terimler ve aciklamalari</span>
                    <div id="bsTermsContainer" class="repeating-group"></div>
                    <button type="button" id="bsAddTermBtn" class="btn btn-sm btn-secondary">+ Terim Ekle</button>

                    <div class="form-actions">
                      <button type="button" id="bsCompanySaveBtn" class="btn btn-primary">Kaydet</button>
                      <span id="bsCompanySaveStatus" class="status-text"></span>
                    </div>

                    <a class="shortcut-link" data-shortcut-panel="panelKB">Bilgi Tabanini Yonet &rarr;</a>
                  </div>
                </div>
                <!-- Tab: Bot Kisiligi -->
                <div id="botSetupTab-persona" class="bot-setup-tab">
                  <div class="bot-setup-form">
                    <h3>Bot Kisiligi</h3>
                    <p class="section-desc">Botun konusma tarzi, tonu ve ornek diyaloglari. Kaydet'e bastiginizda persona.md otomatik guncellenir.</p>

                    <label for="bsPersonaName">Bot Adi</label>
                    <span class="field-hint">Botun kendini tanittigi isim</span>
                    <input id="bsPersonaName" type="text" placeholder="Ornek: Asistan" />

                    <div class="form-grid">
                      <div>
                        <label for="bsPersonaTone">Konusma Tonu</label>
                        <select id="bsPersonaTone">
                          <option value="profesyonel">Profesyonel</option>
                          <option value="samimi">Samimi</option>
                          <option value="resmi">Resmi</option>
                        </select>
                      </div>
                      <div>
                        <label for="bsPersonaEmpathy">Empati Seviyesi</label>
                        <span class="field-hint">Bot ne kadar duygusal katilim gostersin</span>
                        <select id="bsPersonaEmpathy">
                          <option value="dusuk">Dusuk</option>
                          <option value="orta" selected>Orta</option>
                          <option value="yuksek">Yuksek</option>
                        </select>
                      </div>
                    </div>

                    <label for="bsPersonaLength">Yanit Uzunlugu</label>
                    <span class="field-hint">Kisa: 1-2 cumle, Orta: 3-4 cumle, Uzun: detayli paragraf</span>
                    <select id="bsPersonaLength">
                      <option value="kisa">Kisa (1-2 cumle)</option>
                      <option value="orta" selected>Orta (3-4 cumle)</option>
                      <option value="uzun">Uzun (detayli paragraf)</option>
                    </select>

                    <label for="bsPersonaGreeting">Selamlama Mesaji</label>
                    <input id="bsPersonaGreeting" type="text" placeholder="Ornek: Merhaba! Size nasil yardimci olabilirim?" />

                    <label for="bsPersonaDesc">Kisa Tanitim</label>
                    <textarea id="bsPersonaDesc" rows="3" placeholder="Ornek: Ben XYZ firmasinin musteri destek asistaniyim."></textarea>

                    <label>Ornek Diyaloglar</label>
                    <span class="field-hint">Tipik kullanici sorusu ve ideal bot yaniti ciftleri (max 5)</span>
                    <div id="bsDialogsContainer" class="repeating-group"></div>
                    <button type="button" id="bsAddDialogBtn" class="btn btn-sm btn-secondary">+ Ornek Ekle</button>

                    <div class="form-actions">
                      <button type="button" id="bsPersonaSaveBtn" class="btn btn-primary">Kaydet</button>
                      <span id="bsPersonaSaveStatus" class="status-text"></span>
                    </div>
                  </div>
                </div>
                <!-- Tab: Yetenekler -->
                <div id="botSetupTab-skills" class="bot-setup-tab">
                  <div class="bot-setup-form">
                    <h3>Yetenekler</h3>
                    <p class="section-desc">Botun yapabilecegi ve toplayabilecegi bilgileri secin.</p>

                    <div class="checkbox-list">
                      <h4>Bot Yapabilir</h4>
                      <label class="checkbox-list-item"><input type="checkbox" data-skill="troubleshoot" checked /> Adim adim sorun giderme rehberligi</label>
                      <label class="checkbox-list-item"><input type="checkbox" data-skill="kb-answer" checked /> Bilgi tabanindan cevap bulma</label>
                      <label class="checkbox-list-item"><input type="checkbox" data-skill="topic-guide" checked /> Konu bazli troubleshooting</label>
                      <label class="checkbox-list-item"><input type="checkbox" data-skill="escalation" checked /> Canli destek temsilcisine aktarim</label>
                      <label class="checkbox-list-item"><input type="checkbox" data-skill="status-query" /> Randevu/islem durumu sorgulama</label>
                      <label class="checkbox-list-item"><input type="checkbox" data-skill="faq" checked /> Sik sorulan sorulari cevaplama</label>
                    </div>

                    <div class="checkbox-list">
                      <h4>Bot Toplayabilir (eskalasyon icin)</h4>
                      <label class="checkbox-list-item"><input type="checkbox" data-skill-collect="branch-code" checked /> Sube / musteri kodu</label>
                      <label class="checkbox-list-item"><input type="checkbox" data-skill-collect="company-name" checked /> Firma adi</label>
                      <label class="checkbox-list-item"><input type="checkbox" data-skill-collect="issue-summary" checked /> Sorun ozeti</label>
                      <label class="checkbox-list-item"><input type="checkbox" data-skill-collect="contact-info" /> Iletisim bilgisi</label>
                    </div>

                    <label>Ek Yetenek</label>
                    <div id="bsCustomSkillsContainer" class="repeating-group"></div>
                    <button type="button" id="bsAddSkillBtn" class="btn btn-sm btn-secondary">+ Ekle</button>

                    <div class="form-actions">
                      <button type="button" id="bsSkillsSaveBtn" class="btn btn-primary">Kaydet</button>
                      <span id="bsSkillsSaveStatus" class="status-text"></span>
                    </div>

                    <a class="shortcut-link" data-shortcut-panel="panelTopics">Konulari Yonet &rarr;</a>
                  </div>
                </div>
                <!-- Tab: Yasaklar -->
                <div id="botSetupTab-bans" class="bot-setup-tab">
                  <div class="bot-setup-form">
                    <h3>Yasaklar</h3>
                    <p class="section-desc">Botun kesinlikle yapmamasi gereken davranislari secin.</p>

                    <div class="checkbox-list">
                      <h4>Ifsa Yasaklari</h4>
                      <label class="checkbox-list-item"><input type="checkbox" data-ban="share-prompt" checked /> Prompt/sistem talimatlarini paylasma</label>
                      <label class="checkbox-list-item"><input type="checkbox" data-ban="share-model" checked /> AI modeli bilgisi verme</label>
                      <label class="checkbox-list-item"><input type="checkbox" data-ban="share-infra" checked /> Teknik altyapi detaylari paylasma</label>
                    </div>

                    <div class="checkbox-list">
                      <h4>Bilgi Yasaklari</h4>
                      <label class="checkbox-list-item"><input type="checkbox" data-ban="personal-info" checked /> Kisisel bilgi isteme (TC, adres, banka)</label>
                      <label class="checkbox-list-item"><input type="checkbox" data-ban="financial" checked /> Finansal islem bilgisi alma/verme</label>
                      <label class="checkbox-list-item"><input type="checkbox" data-ban="fabricate" checked /> Uydurma/spekulatif bilgi verme</label>
                      <label class="checkbox-list-item"><input type="checkbox" data-ban="competitor" checked /> Rakip firma bilgisi paylasma</label>
                      <label class="checkbox-list-item"><input type="checkbox" data-ban="off-topic" checked /> Platform disi konularda yardim etme</label>
                    </div>

                    <div class="checkbox-list">
                      <h4>Davranis Yasaklari</h4>
                      <label class="checkbox-list-item"><input type="checkbox" data-ban="repeat-info" checked /> Ayni bilgiyi tekrarlama</label>
                      <label class="checkbox-list-item"><input type="checkbox" data-ban="multi-ask" checked /> Tek seferde birden fazla bilgi isteme</label>
                      <label class="checkbox-list-item"><input type="checkbox" data-ban="post-farewell" checked /> Farewell sonrasi yeni konu acma</label>
                    </div>

                    <label>Ozel Yasak</label>
                    <div id="bsCustomBansContainer" class="repeating-group"></div>
                    <button type="button" id="bsAddBanBtn" class="btn btn-sm btn-secondary">+ Ekle</button>

                    <div class="form-actions">
                      <button type="button" id="bsBansSaveBtn" class="btn btn-primary">Kaydet</button>
                      <span id="bsBansSaveStatus" class="status-text"></span>
                    </div>
                  </div>
                </div>
                <!-- Tab: Eskalasyon Kurallari -->
                <div id="botSetupTab-escalation" class="bot-setup-tab">
                  <div class="bot-setup-form">
                    <h3>Eskalasyon Kurallari</h3>
                    <p class="section-desc">Canli temsilciye aktarim kosullarini ve oncesinde toplanacak bilgileri belirleyin.</p>

                    <label>Otomatik Aktarim Kosullari</label>
                    <span class="field-hint">Kosul gerceklesince bot ne yapmali?</span>
                    <div id="bsEscRulesContainer"></div>
                    <button type="button" id="bsAddEscRuleBtn" class="btn btn-sm btn-secondary" style="margin-bottom:16px">+ Kural Ekle</button>

                    <label>Eskalasyon Oncesi Toplanacak Bilgiler</label>
                    <span class="field-hint">Aktarim oncesi kullanicidan hangi bilgiler toplansin?</span>
                    <div class="checkbox-list">
                      <label class="checkbox-list-item"><input type="checkbox" data-esc-field="branch-code" checked /> Sube kodu (zorunlu)</label>
                      <label class="checkbox-list-item"><input type="checkbox" data-esc-field="issue-summary" checked /> Sorun ozeti (zorunlu)</label>
                      <label class="checkbox-list-item"><input type="checkbox" data-esc-field="company-name" /> Firma adi</label>
                      <label class="checkbox-list-item"><input type="checkbox" data-esc-field="phone" /> Telefon</label>
                      <label class="checkbox-list-item"><input type="checkbox" data-esc-field="tried-steps" /> Denenen adimlar</label>
                    </div>
                    <div id="bsEscCustomFieldsContainer" class="repeating-group"></div>
                    <button type="button" id="bsAddEscFieldBtn" class="btn btn-sm btn-secondary">+ Alan Ekle</button>

                    <div class="form-actions">
                      <button type="button" id="bsEscalationSaveBtn" class="btn btn-primary">Kaydet</button>
                      <span id="bsEscalationSaveStatus" class="status-text"></span>
                    </div>
                  </div>
                </div>
                <!-- Tab: Sohbet Akisi -->
                <div id="botSetupTab-chatflow" class="bot-setup-tab">
                  <div id="bsChatFlowContent">
                    <p class="empty">Yukleniyor...</p>
                  </div>
                </div>
                <!-- Tab: Gorunum -->
                <div id="botSetupTab-appearance" class="bot-setup-tab">
                  <div id="bsAppearanceContent">
                    <p class="empty">Yukleniyor...</p>
                  </div>
                </div>
                <!-- Tab: Talep Bilgileri -->
                <div id="botSetupTab-ticket" class="bot-setup-tab">
                  <div class="bot-setup-form">
                    <h3>Talep Bilgileri</h3>
                    <p class="section-desc">Ticket olusturulurken toplanacak alan sablonunu duzenleyin.</p>

                    <label>Zorunlu Alanlar</label>
                    <div id="bsTicketRequiredContainer" class="repeating-group"></div>
                    <button type="button" id="bsAddTicketReqBtn" class="btn btn-sm btn-secondary">+ Zorunlu Alan Ekle</button>

                    <label style="margin-top:16px">Opsiyonel Alanlar</label>
                    <div id="bsTicketOptionalContainer" class="repeating-group"></div>
                    <button type="button" id="bsAddTicketOptBtn" class="btn btn-sm btn-secondary">+ Opsiyonel Alan Ekle</button>

                    <label for="bsTicketConfirmMsg" style="margin-top:16px">Onay Mesaji Sablonu</label>
                    <span class="field-hint">Ticket olusturulduktan sonra kullaniciya gosterilecek mesaj</span>
                    <textarea id="bsTicketConfirmMsg" rows="3" placeholder="Talebiniz basariyla olusturuldu. Ticket numaraniz: {{ticket_id}}"></textarea>

                    <div class="form-actions">
                      <button type="button" id="bsTicketSaveBtn" class="btn btn-primary">Kaydet</button>
                      <span id="bsTicketSaveStatus" class="status-text"></span>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>

          <!-- PANEL: Konular -->
          <div id="panelTopics" class="panel">
            <div class="section-header">
              <h3>Konular</h3>
              <button id="topicAddBtn" class="btn btn-primary">+ Yeni Konu</button>
            </div>
            <div class="table-section">
              <table>
                <thead>
                  <tr>
                    <th>ID</th>
                    <th>Başlık</th>
                    <th>Anahtar Kelimeler</th>
                    <th>Eskalasyon</th>
                    <th>Doğrudan Çözüm</th>
                    <th>İşlemler</th>
                  </tr>
                </thead>
                <tbody id="topicsTableBody">
                  <tr>
                    <td colspan="6" class="empty">Yükleniyor...</td>
                  </tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- PANEL: Bellek Sablonlari -->
          <div id="panelMemory" class="panel">
            <div class="memory-grid" style="grid-template-columns:1fr">
              <div class="memory-card">
                <div class="memory-card-header">
                  <h3>ticket-template.json</h3>
                  <div>
                    <span id="memoryTicketValidation" class="validation-badge"></span>
                    <button id="memoryTicketSaveBtn" class="btn btn-primary btn-sm">Kaydet</button>
                  </div>
                </div>
                <textarea id="memoryTicketTemplate" class="code-editor json-editor"></textarea>
              </div>
              <!-- conversation-schema.json: sistem icin, gizli -->
              <div class="memory-card" style="display:none">
                <div class="memory-card-header">
                  <h3>conversation-schema.json</h3>
                  <div>
                    <span id="memorySchemaValidation" class="validation-badge"></span>
                    <button id="memorySchemaSaveBtn" class="btn btn-primary btn-sm">Kaydet</button>
                  </div>
                </div>
                <textarea id="memoryConversationSchema" class="code-editor json-editor"></textarea>
              </div>
            </div>
          </div>

          <!-- PANEL: Ortam Degiskenleri -->
          <div id="panelEnv" class="panel">
            <form id="envForm">
              <!-- Groups will be built by JS -->
            </form>
            <div class="env-actions">
              <button id="envSaveBtn" class="btn btn-primary">Kaydet</button>
              <span id="envSaveStatus" class="status-text"></span>
            </div>
          </div>

          <!-- PANEL: Sohbet Akisi -->
          <div id="panelChatFlow" class="panel">
            <div class="chat-flow-config">
              <h3>Sohbet Akış Ayarları</h3>
              <p class="section-desc">Chatbot davranış ve zamanlama ayarlarını buradan yapılandırabilirsiniz.</p>

              <div class="cf-group">
                <h4>Karşılama</h4>
                <div class="cf-field">
                  <label for="cfWelcomeMessage">Karşılama Mesajı</label>
                  <textarea id="cfWelcomeMessage" rows="2" class="cf-textarea"></textarea>
                </div>
              </div>

              <div class="cf-group">
                <h4>Zamanlama</h4>
                <div class="cf-field">
                  <label for="cfAggregationMs">Mesaj Birleştirme Penceresi (ms)</label>
                  <div class="cf-range-row">
                    <input id="cfAggregationMs" type="range" min="1000" max="10000" step="500" />
                    <span id="cfAggregationMsVal" class="cf-range-val"></span>
                  </div>
                  <small>Kullanıcı art arda mesaj yazarken birleştirme bekleme süresi</small>
                </div>
                <div class="cf-field">
                  <label for="cfBotDelayMs">Bot Yanıt Gecikmesi (ms)</label>
                  <div class="cf-range-row">
                    <input id="cfBotDelayMs" type="range" min="0" max="5000" step="250" />
                    <span id="cfBotDelayMsVal" class="cf-range-val"></span>
                  </div>
                  <small>Yazıyor animasyonu süresi (doğal hissettirmek için)</small>
                </div>
                <div class="cf-field cf-toggle-field">
                  <label for="cfTypingEnabled">Yazıyor Göstergesi</label>
                  <input id="cfTypingEnabled" type="checkbox" class="cf-toggle" />
                </div>
              </div>

              <div class="cf-group">
                <h4>Hareketsizlik ve Uyarı</h4>
                <div class="cf-field">
                  <label for="cfInactivityMs">Hareketsizlik Zamanlayıcı (dakika)</label>
                  <div class="cf-range-row">
                    <input id="cfInactivityMs" type="range" min="1" max="30" step="1" />
                    <span id="cfInactivityMsVal" class="cf-range-val"></span>
                  </div>
                </div>
                <div class="cf-field cf-toggle-field">
                  <label for="cfNudgeEnabled">Uyarı Mesajları Aktif</label>
                  <input id="cfNudgeEnabled" type="checkbox" class="cf-toggle" />
                </div>
                <div class="cf-field">
                  <label for="cfNudge75">%75 Uyarı Mesajı</label>
                  <textarea id="cfNudge75" rows="2" class="cf-textarea"></textarea>
                </div>
                <div class="cf-field">
                  <label for="cfNudge90">%90 Uyarı Mesajı</label>
                  <textarea id="cfNudge90" rows="2" class="cf-textarea"></textarea>
                </div>
                <div class="cf-field">
                  <label for="cfInactivityClose">Zaman Aşımı Mesajı</label>
                  <textarea id="cfInactivityClose" rows="2" class="cf-textarea"></textarea>
                </div>
              </div>

              <div class="cf-group">
                <h4>Akıllı Algılama</h4>
                <div class="cf-field cf-toggle-field">
                  <label for="cfGibberishEnabled">Anlamsız Mesaj Algılama</label>
                  <input id="cfGibberishEnabled" type="checkbox" class="cf-toggle" />
                </div>
                <div class="cf-field">
                  <label for="cfGibberishMsg">Anlamsız Mesaj Yanıtı</label>
                  <textarea id="cfGibberishMsg" rows="2" class="cf-textarea"></textarea>
                </div>
                <div class="cf-field">
                  <label for="cfMaxRetries">Maks. Aydınlatma Tekrarı</label>
                  <div class="cf-range-row">
                    <input id="cfMaxRetries" type="range" min="1" max="10" step="1" />
                    <span id="cfMaxRetriesVal" class="cf-range-val"></span>
                  </div>
                  <small>Bu sayıda tekrardan sonra canlı destek'e aktarılır</small>
                </div>
              </div>

              <div class="cf-group">
                <h4>Kapanış Akışı</h4>
                <div class="cf-field cf-toggle-field">
                  <label for="cfClosingEnabled">Kapanış Akışı Aktif</label>
                  <input id="cfClosingEnabled" type="checkbox" class="cf-toggle" />
                </div>
                <div class="cf-field">
                  <label for="cfAnythingElse">Başka Bir Şey Var Mı Mesajı</label>
                  <textarea id="cfAnythingElse" rows="2" class="cf-textarea"></textarea>
                </div>
                <div class="cf-field">
                  <label for="cfFarewell">Veda Mesajı</label>
                  <textarea id="cfFarewell" rows="2" class="cf-textarea"></textarea>
                </div>
                <div class="cf-field cf-toggle-field">
                  <label for="cfCsatEnabled">CSAT Değerlendirme</label>
                  <input id="cfCsatEnabled" type="checkbox" class="cf-toggle" />
                </div>
                <div class="cf-field">
                  <label for="cfCsatMsg">CSAT Mesajı</label>
                  <textarea id="cfCsatMsg" rows="2" class="cf-textarea"></textarea>
                </div>
              </div>

              <div class="cf-actions">
                <button id="cfSaveBtn" class="btn btn-primary">Kaydet</button>
                <button id="cfResetBtn" class="btn btn-secondary">Varsayılana Dön</button>
                <span id="cfSaveStatus" class="status-text"></span>
              </div>
            </div>
          </div>

          <!-- PANEL: Site Ayarlari -->
          <div id="panelSiteConfig" class="panel">
            <div class="chat-flow-config">
              <h3>Site Ayarları</h3>
              <p class="section-desc">Chatbot sayfasının görünümünü ve markasını buradan özelleştirin. Değişiklikler sunucuda saklanır, GitHub reposunu etkilemez.</p>

              <div class="cf-group">
                <h4>Logo</h4>
                <div class="cf-field">
                  <label>Mevcut Logo</label>
                  <div style="display:flex;align-items:center;gap:12px;margin-bottom:8px">
                    <img id="scLogoPreview" src="qragy_logo.jpg" alt="Logo" style="width:48px;height:48px;object-fit:contain;border-radius:8px;border:1px solid var(--line)" />
                    <span id="scLogoName" style="color:var(--muted);font-size:0.85rem">Varsayılan logo</span>
                  </div>
                  <label class="btn btn-secondary file-upload-label" style="display:inline-block">
                    Logo Yükle (max 2MB)
                    <input type="file" id="scLogoInput" accept="image/jpeg,image/png,image/svg+xml,image/webp,image/gif" hidden />
                  </label>
                  <span id="scLogoStatus" class="status-text" style="margin-left:8px"></span>
                </div>
              </div>

              <div class="cf-group">
                <h4>Sayfa Metinleri</h4>
                <div class="cf-field">
                  <label for="scPageTitle">Sayfa Başlığı (browser tab)</label>
                  <input id="scPageTitle" type="text" class="cf-textarea" style="height:auto" />
                </div>
                <div class="cf-field">
                  <label for="scHeroTitle">Ana Başlık</label>
                  <input id="scHeroTitle" type="text" class="cf-textarea" style="height:auto" />
                </div>
                <div class="cf-field">
                  <label for="scHeroDescription">Açıklama Metni</label>
                  <textarea id="scHeroDescription" rows="2" class="cf-textarea"></textarea>
                </div>
                <div class="cf-field">
                  <label for="scHeroButtonText">Başlat Butonu Metni</label>
                  <input id="scHeroButtonText" type="text" class="cf-textarea" style="height:auto" />
                </div>
                <div class="cf-field">
                  <label for="scHeroHint">Alt Açıklama</label>
                  <textarea id="scHeroHint" rows="2" class="cf-textarea"></textarea>
                </div>
              </div>

              <div class="cf-group">
                <h4>Sohbet Penceresi</h4>
                <div class="cf-field">
                  <label for="scHeaderTitle">Header Başlığı</label>
                  <input id="scHeaderTitle" type="text" class="cf-textarea" style="height:auto" />
                </div>
                <div class="cf-field">
                  <label for="scInputPlaceholder">Mesaj Alanı Placeholder</label>
                  <input id="scInputPlaceholder" type="text" class="cf-textarea" style="height:auto" />
                </div>
                <div class="cf-field">
                  <label for="scSendButtonText">Gönder Butonu Metni</label>
                  <input id="scSendButtonText" type="text" class="cf-textarea" style="height:auto" />
                </div>
              </div>

              <div class="cf-group">
                <h4>Renkler</h4>
                <div class="cf-field">
                  <label for="scThemeColor">Tema Rengi (browser)</label>
                  <div style="display:flex;align-items:center;gap:8px">
                    <input id="scThemeColor" type="color" style="width:40px;height:32px;border:1px solid var(--line);border-radius:4px;cursor:pointer" />
                    <span id="scThemeColorHex" style="font-size:0.85rem;color:var(--muted)"></span>
                  </div>
                </div>
                <div class="cf-field">
                  <label for="scPrimaryColor">Ana Renk (butonlar, vurgular)</label>
                  <div style="display:flex;align-items:center;gap:8px">
                    <input id="scPrimaryColor" type="color" style="width:40px;height:32px;border:1px solid var(--line);border-radius:4px;cursor:pointer" />
                    <span id="scPrimaryColorHex" style="font-size:0.85rem;color:var(--muted)"></span>
                  </div>
                  <small>Boş bırakırsanız varsayılan tema rengi kullanılır</small>
                </div>
                <div class="cf-field">
                  <label for="scHeaderBg">Header Arka Plan Rengi</label>
                  <div style="display:flex;align-items:center;gap:8px">
                    <input id="scHeaderBg" type="color" value="#2563EB" style="width:40px;height:32px;border:1px solid var(--line);border-radius:4px;cursor:pointer" />
                    <span id="scHeaderBgHex" style="font-size:0.85rem;color:var(--muted)"></span>
                  </div>
                  <small>Boş bırakırsanız varsayılan gradient kullanılır</small>
                </div>
                <div class="cf-field">
                  <label for="scChatBubbleColor">Sohbet Balonu Rengi</label>
                  <div style="display:flex;align-items:center;gap:8px">
                    <input id="scChatBubbleColor" type="color" value="#2563EB" style="width:40px;height:32px;border:1px solid var(--line);border-radius:4px;cursor:pointer" />
                    <span id="scChatBubbleColorHex" style="font-size:0.85rem;color:var(--muted)"></span>
                  </div>
                  <small>Bot mesaj balonlarının arka plan rengi</small>
                </div>
              </div>

              <div class="cf-actions">
                <button id="scSaveBtn" class="btn btn-primary">Kaydet</button>
                <button id="scResetBtn" class="btn btn-secondary">Varsayılana Dön</button>
                <span id="scSaveStatus" class="status-text"></span>
              </div>
            </div>
          </div>

          <!-- PANEL: Webhooks -->
          <div id="panelWebhooks" class="panel">
            <div class="section-header">
              <h3>Webhook Bildirimleri</h3>
              <button id="webhookAddBtn" class="btn btn-primary">+ Yeni Webhook</button>
            </div>
            <div class="table-section">
              <table>
                <thead>
                  <tr>
                    <th>URL</th>
                    <th>Olaylar</th>
                    <th>Durum</th>
                    <th>İşlemler</th>
                  </tr>
                </thead>
                <tbody id="webhooksTableBody">
                  <tr><td colspan="4" class="empty">Yükleniyor...</td></tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- PANEL: Prompt Gecmisi -->
          <div id="panelPromptVersions" class="panel">
            <div class="section-header">
              <h3>Prompt Versiyon Geçmişi</h3>
            </div>
            <div class="table-section">
              <table>
                <thead>
                  <tr>
                    <th>Dosya</th>
                    <th>Tarih</th>
                    <th>Boyut</th>
                    <th>İşlemler</th>
                  </tr>
                </thead>
                <tbody id="promptVersionsTableBody">
                  <tr><td colspan="4" class="empty">Yükleniyor...</td></tr>
                </tbody>
              </table>
            </div>
          </div>

          <!-- PANEL: CRM Entegrasyonu -->
          <div id="panelSunshine" class="panel">
            <div class="chat-flow-config">
              <h3>CRM Entegrasyonu (Zendesk Sunshine Conversations)</h3>
              <p class="section-desc">Zendesk Sunshine Conversations entegrasyonu ile Zendesk chat widget üzerinden gelen mesajları Qragy ile karşılayın. Eskalasyonda canlı temsilciye otomatik aktarım yapılır.</p>

              <div class="cf-group">
                <h4>Bağlantı Ayarları</h4>
                <div class="cf-field">
                  <label for="sunEnabled">Entegrasyon Durumu</label>
                  <select id="sunEnabled" class="cf-textarea" style="height:auto">
                    <option value="false">Kapalı</option>
                    <option value="true">Açık</option>
                  </select>
                </div>
                <div class="cf-field">
                  <label for="sunSubdomain">Zendesk Subdomain</label>
                  <input id="sunSubdomain" type="text" class="cf-textarea" style="height:auto" placeholder="firmaadiniz (firmaadiniz.zendesk.com)" />
                </div>
                <div class="cf-field">
                  <label for="sunAppId">App ID</label>
                  <input id="sunAppId" type="text" class="cf-textarea" style="height:auto" placeholder="Sunshine Conversations App ID" />
                </div>
                <div class="cf-field">
                  <label for="sunKeyId">API Key ID</label>
                  <input id="sunKeyId" type="text" class="cf-textarea" style="height:auto" placeholder="API Key ID" />
                </div>
                <div class="cf-field">
                  <label for="sunKeySecret">API Key Secret</label>
                  <input id="sunKeySecret" type="password" class="cf-textarea" style="height:auto" placeholder="API Key Secret" />
                </div>
                <div class="cf-field">
                  <label for="sunWebhookSecret">Webhook Secret (X-API-Key)</label>
                  <input id="sunWebhookSecret" type="password" class="cf-textarea" style="height:auto" placeholder="Webhook doğrulama anahtarı" />
                </div>
                <div class="cf-field">
                  <label for="sunFarewellMessage">Eskalasyon Veda Mesajı</label>
                  <textarea id="sunFarewellMessage" rows="2" class="cf-textarea" placeholder="Canlı temsilciye aktarılırken gönderilecek mesaj"></textarea>
                </div>
              </div>

              <div class="cf-group">
                <h4>Webhook URL</h4>
                <p class="section-desc">Zendesk Sunshine Conversations ayarlarından aşağıdaki URL'yi webhook olarak ekleyin. Trigger: <code>conversation:message</code></p>
                <div class="cf-field">
                  <label>Webhook Endpoint</label>
                  <div style="display:flex;align-items:center;gap:8px">
                    <code id="sunWebhookUrl" style="background:var(--bg);padding:8px 12px;border-radius:6px;border:1px solid var(--line);flex:1;word-break:break-all;font-size:0.85rem"></code>
                    <button id="sunCopyUrlBtn" class="btn btn-secondary" style="white-space:nowrap">Kopyala</button>
                  </div>
                </div>
              </div>

              <div class="cf-group">
                <h4>Bağlantı Durumu</h4>
                <div id="sunTestResult" style="padding:8px 12px;border-radius:6px;font-size:0.9rem;display:none"></div>
              </div>

              <div class="cf-actions">
                <button id="sunSaveBtn" class="btn btn-primary">Kaydet</button>
                <button id="sunTestBtn" class="btn btn-secondary">Bağlantıyı Test Et</button>
                <span id="sunSaveStatus" class="status-text"></span>
              </div>
            </div>
          </div>

          <!-- PANEL: WhatsApp Entegrasyonu -->
          <div id="panelWhatsApp" class="panel">
            <div class="chat-flow-config">
              <h3>WhatsApp Entegrasyonu (Cloud API)</h3>
              <p class="section-desc">WhatsApp Business Cloud API entegrasyonu ile WhatsApp uzerinden gelen mesajlari Qragy ile karsilayin.</p>

              <div class="cf-group">
                <h4>Baglanti Ayarlari</h4>
                <div class="cf-field">
                  <label for="waEnabled">Entegrasyon Durumu</label>
                  <select id="waEnabled" class="cf-textarea" style="height:auto">
                    <option value="false">Kapali</option>
                    <option value="true">Acik</option>
                  </select>
                </div>
                <div class="cf-field">
                  <label for="waPhoneNumberId">Phone Number ID</label>
                  <input id="waPhoneNumberId" type="text" class="cf-textarea" style="height:auto" placeholder="Meta Business Phone Number ID" />
                </div>
                <div class="cf-field">
                  <label for="waAccessToken">Access Token</label>
                  <input id="waAccessToken" type="password" class="cf-textarea" style="height:auto" placeholder="Permanent Access Token" />
                </div>
                <div class="cf-field">
                  <label for="waVerifyToken">Verify Token</label>
                  <input id="waVerifyToken" type="text" class="cf-textarea" style="height:auto" placeholder="Webhook dogrulama tokeni (sizin belirlediginiz)" />
                </div>
              </div>

              <div class="cf-group">
                <h4>Webhook URL</h4>
                <p class="section-desc">Meta Developer Portal'dan asagidaki URL'yi webhook olarak ekleyin. Subscriptions: <code>messages</code></p>
                <div class="cf-field">
                  <label>Webhook Endpoint</label>
                  <div style="display:flex;align-items:center;gap:8px">
                    <code id="waWebhookUrl" style="background:var(--bg);padding:8px 12px;border-radius:6px;border:1px solid var(--line);flex:1;word-break:break-all;font-size:0.85rem"></code>
                    <button id="waCopyUrlBtn" class="btn btn-secondary" style="white-space:nowrap">Kopyala</button>
                  </div>
                </div>
              </div>

              <div class="cf-actions">
                <button id="waSaveBtn" class="btn btn-primary">Kaydet</button>
                <span id="waSaveStatus" class="status-text"></span>
              </div>
            </div>
          </div>

          <!-- PANEL: Bot Test -->
          <div id="panelBotTest" class="panel">
            <iframe
              id="botTestIframe"
              src="test-widget.html?testMode=true"
              style="width:100%;height:100%;border:none;border-radius:8px"
              title="Bot Test"
            ></iframe>
          </div>

          <!-- PANEL: Analitik Dashboard -->
          <div id="panelAnalytics" class="panel">
            <div class="section-header">
              <h2>Analitik</h2>
              <div class="section-actions">
                <select id="analyticsRange">
                  <option value="7d" selected>Son 7 Gün</option>
                  <option value="30d">Son 30 Gün</option>
                  <option value="90d">Son 90 Gün</option>
                </select>
              </div>
            </div>

            <!-- KPI Dashboard Cards -->
            <div id="dashboardKpi" class="kpi-grid">
              <div class="kpi-card">
                <div class="kpi-label">Bugun Sohbet</div>
                <div class="kpi-value" id="kpiTodayChats">-</div>
                <div class="kpi-sub" id="kpiTodayResolution"></div>
              </div>
              <div class="kpi-card">
                <div class="kpi-label">Haftalik Sohbet</div>
                <div class="kpi-value" id="kpiWeeklyChats">-</div>
                <div class="kpi-trend" id="kpiWeeklyTrend"></div>
              </div>
              <div class="kpi-card">
                <div class="kpi-label">Haftalik CSAT</div>
                <div class="kpi-value" id="kpiWeeklyCsat">-</div>
                <div class="kpi-trend" id="kpiCsatTrend"></div>
              </div>
              <div class="kpi-card">
                <div class="kpi-label">Aylik Cozum Orani</div>
                <div class="kpi-value" id="kpiMonthlyResolution">-</div>
                <div class="kpi-trend" id="kpiMonthlyTrend"></div>
              </div>
            </div>

            <!-- Top Topics (from dashboard-stats) -->
            <div id="dashboardTopTopics" class="kpi-topics" style="display:none">
              <h4>Bu Haftanin En Cok Konusulan 5 Konusu</h4>
              <div id="kpiTopTopicsList" class="kpi-topics-list"></div>
            </div>

            <div id="analyticsSummary" class="summary-grid"></div>

            <div class="analytics-chart-section">
              <h3>Günlük Sohbet Sayısı</h3>
              <div id="analyticsChart" class="analytics-chart"></div>
            </div>

            <div class="analytics-topics-section">
              <h3>En Çok Konuşulan Konular</h3>
              <div class="table-section">
                <table>
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>Konu</th>
                      <th>Sayı</th>
                    </tr>
                  </thead>
                  <tbody id="topTopicsTableBody">
                    <tr><td colspan="3" class="empty">Yükleniyor...</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- PANEL: Feedback Raporu -->
          <div id="panelFeedbackReport" class="panel">
            <div class="section-header">
              <h2>Feedback Raporu</h2>
              <div class="section-actions">
                <select id="feedbackDaysRange">
                  <option value="7" selected>Son 7 Gun</option>
                  <option value="30">Son 30 Gun</option>
                  <option value="90">Son 90 Gun</option>
                </select>
              </div>
            </div>
            <div id="feedbackSummary" class="summary-grid"></div>
            <div class="analytics-topics-section" style="margin-top:16px">
              <h3>En Cok Tekrarlanan Sorunlar</h3>
              <div class="table-section">
                <table>
                  <thead>
                    <tr>
                      <th>#</th>
                      <th>Konu (Anahtar Kelimeler)</th>
                      <th>Tekrar</th>
                      <th>Ornek Mesajlar</th>
                    </tr>
                  </thead>
                  <tbody id="feedbackTopIssuesBody">
                    <tr><td colspan="4" class="empty">Yukleniyor...</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
            <div class="analytics-topics-section" style="margin-top:16px">
              <h3>Negatif Feedback Detaylari</h3>
              <div class="table-section">
                <table>
                  <thead>
                    <tr>
                      <th>Kullanici Mesaji</th>
                      <th>Bot Yaniti</th>
                      <th>Tarih</th>
                    </tr>
                  </thead>
                  <tbody id="feedbackNegativeBody">
                    <tr><td colspan="3" class="empty">Yukleniyor...</td></tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <!-- PANEL: Content Gaps -->
          <div id="panelContentGaps" class="panel">
            <div class="section-header">
              <h2>Cevaplanamayan Sorular (Content Gaps)</h2>
            </div>
            <div id="contentGapsSection" class="table-section">
              <p class="empty">Yükleniyor...</p>
            </div>
          </div>

          <!-- PANEL: Sistem Durumu -->
          <div id="panelSystem" class="panel">
            <div class="section-header">
              <h2>Sistem Durumu</h2>
              <div class="section-actions">
                <button id="sysRefreshBtn" class="btn btn-secondary">Yenile</button>
                <button id="sysReloadBtn" class="btn btn-primary">Agent Config Yeniden Yükle</button>
              </div>
            </div>

            <div id="sysHealthGrid" class="health-grid">
              <!-- Health cards populated by JS -->
            </div>

            <!-- SLA Summary -->
            <div class="analytics-topics-section" style="margin-bottom:20px">
              <h3>SLA Durumu</h3>
              <div id="slaSummary" class="summary-grid"></div>
              <div id="slaBreaches" class="table-section" style="margin-top:8px"></div>
            </div>

            <!-- Audit Log -->
            <div class="analytics-topics-section" style="margin-bottom:20px">
              <h3>Değişiklik Geçmişi (Audit Log)</h3>
              <div id="auditLogSection" class="table-section"></div>
            </div>

            <div class="status-sections">
              <div class="status-section">
                <h3>Agent Dosyaları</h3>
                <div id="sysAgentStatus"></div>
              </div>
              <div class="status-section">
                <h3>Bilgi Tabanı</h3>
                <div id="sysKBStatus"></div>
              </div>
            </div>
          </div>

        </div><!-- /.admin-main -->
      </div><!-- /.admin-layout -->

      <!-- KB Modal -->
      <div id="kbModal" class="modal-overlay" style="display:none">
        <div class="modal">
          <div class="modal-header">
            <h3 id="kbModalTitle">Yeni Kayıt</h3>
            <button id="kbModalCancelBtn" class="modal-close">&times;</button>
          </div>
          <div class="modal-body">
            <label>Soru<textarea id="kbModalQuestion" rows="3"></textarea></label>
            <label>Cevap<textarea id="kbModalAnswer" rows="5"></textarea></label>
          </div>
          <div class="modal-footer">
            <button id="kbModalSaveBtn" class="btn btn-primary">Kaydet</button>
          </div>
        </div>
      </div>

      <!-- Topic Modal -->
      <div id="topicModal" class="modal-overlay" style="display:none">
        <div class="modal modal-lg">
          <div class="modal-header">
            <h3 id="topicModalHeader">Konu Düzenle</h3>
            <button id="topicModalCancelBtn" class="modal-close">&times;</button>
          </div>
          <div class="modal-body">
            <!-- Wizard Steps Indicator -->
            <div id="topicWizardSteps" class="wizard-steps">
              <span class="wizard-step active" data-step="1">1. Konu Adi</span>
              <span class="wizard-step" data-step="2">2. Anahtar Kelimeler</span>
              <span class="wizard-step" data-step="3">3. Bot Yaniti</span>
              <span class="wizard-step" data-step="4">4. Eskalasyon</span>
            </div>

            <!-- Step 1: Name & ID -->
            <div class="wizard-panel" data-wizard="1">
              <div class="form-grid">
                <label>Başlık<span class="field-hint">Admin icin konu adi. Ornek: Bilet Yazdiramiyorum</span><input id="topicModalTitle" type="text" placeholder="Konu basligi" /></label>
                <label>ID (Slug)<span class="field-hint">Otomatik olusturulur, isterseniz degistirebilirsiniz.</span><input id="topicModalId" type="text" placeholder="konu-slug" /></label>
              </div>
            </div>

            <!-- Step 2: Keywords -->
            <div class="wizard-panel" data-wizard="2" style="display:none">
              <label>Kullanici bu konuyu nasil sorar?<span class="field-hint">Virgul ile ayrilmis anahtar kelimeler. Ne kadar cok varyasyon eklerseniz tespit o kadar iyi olur.</span></label>
              <input id="topicModalKeywords" type="text" placeholder="bilet yazdiramiyorum, bilet cikmiyor, yazici basmiyor" />
              <button id="topicSuggestKeywordsBtn" class="btn btn-sm" style="margin-top:8px">AI ile Oner</button>
              <div id="topicKeywordSuggestion" style="display:none;margin-top:8px;padding:8px;background:var(--bg-secondary);border-radius:6px;font-size:13px"></div>
            </div>

            <!-- Step 3: Content -->
            <div class="wizard-panel" data-wizard="3" style="display:none">
              <label>Bot ne yanit vermeli?<span class="field-hint">AI'a bu konuda nasil davranacagini anlatan talimat. Troubleshoot adimlari, bilgilendirme metni yazabilirsiniz.</span></label>
              <textarea id="topicModalContent" rows="10" class="code-editor" placeholder="Bu konuda su adimlari izle:&#10;1. ...&#10;2. ..."></textarea>
            </div>

            <!-- Step 4: Escalation -->
            <div class="wizard-panel" data-wizard="4" style="display:none">
              <div class="form-row">
                <div class="checkbox-group">
                  <label class="checkbox-label"><input id="topicModalRequiresEscalation" type="checkbox" /> Canli destege aktarilsin mi?</label>
                  <span class="field-hint">Isaretlenirse bu konu sonunda canli temsilciye aktarim yapilir.</span>
                </div>
                <div class="checkbox-group">
                  <label class="checkbox-label"><input id="topicModalCanResolveDirectly" type="checkbox" /> AI dogrudan cozebilir mi?</label>
                  <span class="field-hint">Isaretlenirse AI bilgilendirme yapip konuyu kapatabilir.</span>
                </div>
              </div>
              <label>Gerekli Bilgiler (virgul ile)<span class="field-hint">Eskalasyon oncesi kullanicidan toplanmasi gereken alanlar.</span><input id="topicModalRequiredInfo" type="text" placeholder="firma_adi, sefer_guzergah, sefer_tarih_saat" /></label>
            </div>
          </div>
          <div class="modal-footer" style="justify-content:space-between">
            <button id="topicWizardPrevBtn" class="btn" style="display:none">Geri</button>
            <div>
              <button id="topicWizardNextBtn" class="btn btn-primary">Ileri</button>
              <button id="topicModalSaveBtn" class="btn btn-primary" style="display:none">Kaydet</button>
            </div>
          </div>
        </div>
      </div>

      <!-- Webhook Modal -->
      <div id="webhookModal" class="modal-overlay" style="display:none">
        <div class="modal">
          <div class="modal-header">
            <h3 id="webhookModalTitle">Yeni Webhook</h3>
            <button id="webhookModalCancelBtn" class="modal-close">&times;</button>
          </div>
          <div class="modal-body">
            <label>URL<input id="webhookModalUrl" type="url" placeholder="https://example.com/webhook" /></label>
            <label>Olaylar (virgul ile)<span class="field-hint">ticket_created, escalation, csat_rating, handoff_result veya * (tümü)</span><input id="webhookModalEvents" type="text" placeholder="*" value="*" /></label>
            <label>Secret (opsiyonel)<input id="webhookModalSecret" type="text" placeholder="HMAC secret" /></label>
          </div>
          <div class="modal-footer">
            <button id="webhookModalSaveBtn" class="btn btn-primary">Kaydet</button>
          </div>
        </div>
      </div>

      <!-- Confirm Modal -->
      <div id="confirmModal" class="modal-overlay" style="display:none">
        <div class="modal modal-sm">
          <div class="modal-body">
            <p id="confirmModalText">Emin misiniz?</p>
          </div>
          <div class="modal-footer">
            <button id="confirmModalNo" class="btn btn-secondary">İptal</button>
            <button id="confirmModalYes" class="btn btn-danger">Onayla</button>
          </div>
        </div>
      </div>

      <!-- Admin Assistant Chatbot -->
      <div id="adminAssistant" class="admin-assistant">
        <button id="adminAssistantToggle" class="assistant-toggle" title="Qragy Asistan">?</button>
        <div id="adminAssistantPanel" class="assistant-panel" style="display:none">
          <div class="assistant-header">
            <span>Qragy Asistan</span>
            <button id="adminAssistantClose" class="assistant-close-btn">&times;</button>
          </div>
          <div id="adminAssistantMessages" class="assistant-messages"></div>
          <div id="adminAssistantFilePreview" class="assistant-file-preview" style="display:none">
            <span id="assistantFileName"></span>
            <button id="assistantFileClear" class="btn-remove">&times;</button>
          </div>
          <div class="assistant-input-row">
            <label class="assistant-file-btn" title="Dosya ekle">
              <input id="adminAssistantFileInput" type="file" accept=".txt,.pdf,.docx,.xlsx,.xls" hidden />
              +
            </label>
            <input id="adminAssistantInput" type="text" placeholder="Derdini anlat veya dosya at..." />
            <button id="adminAssistantSend" class="btn btn-primary btn-sm">Gonder</button>
          </div>
        </div>
      </div>

      <!-- Toast Container -->
      <div id="toastContainer" class="toast-container"></div>

    </main>

    <script src="admin.js?v=20260222b"></script>
  </body>
</html>
